#include <iostream>            // Подключаем библиотеку для ввода/вывода
#include <vector>             // Подключаем библиотеку для работы с динамическими массивами (векторами)
#include <deque>              // Подключаем библиотеку для работы с двухсторонними очередями (деками)
#include <list>               // Подключаем библиотеку для работы с двусвязными списками
#include <fstream>            // Подключаем библиотеку для работы с файлами
#include <iterator>           // Подключаем библиотеку для работы с итераторами
#include <algorithm>          // Подключаем библиотеку для алгоритмов (например, сортировка)
#include <stdexcept>          // Подключаем библиотеку для обработки исключений
#include <string>             // Подключаем библиотеку для работы со строками
#include <limits>             // Подключаем библиотеку для использования пределов типов данных

using namespace std;          // Используем стандартное пространство имен

// Функция для ввода целых чисел с проверкой
int inputInteger(const string& prompt = "Введите целое число: ", bool showPrompt = true) {
    int number;  // Переменная для хранения введенного числа
    while (true) {  // Бесконечный цикл для повторного ввода в случае ошибки
        if (showPrompt) {  // Если нужно показать подсказку
            cout << prompt;  // Выводим подсказку
        }
        if (cin >> number) {  // Если ввод успешен
            cin.ignore(numeric_limits<streamsize>::max(), '\n');  // Очищаем оставшийся ввод в буфере
            return number;  // Возвращаем введенное число
        } else {  // Если ввод не удачен
            cout << "Ошибка: введено не целое число. Пожалуйста, попробуйте снова." << endl;  // Сообщаем об ошибке
            cin.clear();  // Сбрасываем состояние потока ввода
            cin.ignore(numeric_limits<streamsize>::max(), '\n');  // Очищаем буфер
        }
    }
}

// Задание 1
void task1(const string& filename) {
    ifstream infile(filename);  // Открываем файл для чтения
    if (!infile.is_open()) {  // Проверяем, открыт ли файл
        cout << "Ошибка открытия файла." << endl;  // Сообщаем об ошибке
        return;  // Выходим из функции
    }

    vector<int> V;  // Создаем вектор для хранения целых чисел
    int num;  // Переменная для чтения числа из файла
    while (infile >> num) {  // Читаем числа из файла
        V.push_back(num);  // Добавляем прочитанное число в вектор
    }

    if (!infile.eof()) {  // Проверяем, достигнут ли конец файла
        cout << "Ошибка: файл содержит неверный формат данных." << endl;  // Сообщаем об ошибке
        infile.close();  // Закрываем файл
        return;  // Выходим из функции
    }

    infile.close();  // Закрываем файл после чтения

    cout << "Содержимое вектора в порядке ввода: ";  // Сообщаем о выводе содержимого вектора
    for (const auto& elem : V) {  // Проходим по всем элементам вектора
        cout << elem << " ";  // Выводим каждый элемент
    }
    cout << endl;  // Переход на новую строку
}

// Задание 2
void task2() {
    int nV = inputInteger("Введите количество элементов для вектора: ");  // Вводим количество элементов для вектора

    if (nV % 2 != 0) {  // Проверяем, является ли количество элементов четным
        cout << "Ошибка: введено нечетное количество элементов для вектора." << endl;  // Сообщаем об ошибке
        return;  // Выходим из функции
    }

    vector<int> V(nV);  // Создаем вектор фиксированной длины
    cout << "Введите элементы вектора: ";  // Подсказка для ввода элементов вектора
    for (int i = 0; i < nV; i++) {  // Цикл для ввода элементов
        V[i] = inputInteger("", false);  // Вводим элементы без подсказки
    }

    vector<int> originalV = V;  // Сохраняем оригинальные элементы вектора

    int nD = inputInteger("Введите количество элементов для дека: ");  // Вводим количество элементов для дека

    if (nD % 2 != 0) {  // Проверяем, является ли количество элементов четным
        cout << "Ошибка: введено нечетное количество элементов для дека." << endl;  // Сообщаем об ошибке
        return;  // Выходим из функции
    }

    deque<int> D(nD);  // Создаем дек фиксированной длины
    cout << "Введите элементы дека: ";  // Подсказка для ввода элементов дека
    for (int i = 0; i < nD; i++) {  // Цикл для ввода элементов
        D[i] = inputInteger("", false);  // Вводим элементы без подсказки
    }

    size_t halfSizeV = V.size() / 2;  // Вычисляем половину размера вектора
    size_t halfSizeD = D.size() / 2;  // Вычисляем половину размера дека

    V.insert(V.end(), D.begin(), D.begin() + halfSizeD);  // Добавляем первую половину дека в конец вектора
    D.insert(D.begin(), originalV.rbegin(), originalV.rbegin() + halfSizeV);  // Добавляем реверс оригинального вектора в начало дека

    cout << "Обновленный вектор: ";  // Подсказка для вывода обновленного вектора
    for (const auto& elem : V) {  // Проходим по всем элементам вектора
        cout << elem << " ";  // Выводим каждый элемент
    }
    cout << endl;  // Переход на новую строку

    cout << "Обновленный дек: ";  // Подсказка для вывода обновленного дека
    for (const auto& elem : D) {  // Проходим по всем элементам дека
        cout << elem << " ";  // Выводим каждый элемент
    }
    cout << endl;  // Переход на новую строку
}

// Задание 3
void task3() {
    int n = inputInteger("Введите количество целых чисел для вектора: ");  // Вводим количество целых чисел для вектора

    vector<int> V;  // Создаем вектор для хранения чисел
    cout << "Введите " << n << " целых чисел: ";  // Подсказка для ввода чисел
    for (int i = 0; i < n; ++i) {  // Цикл для ввода чисел
        V.push_back(inputInteger("", false));  // Вводим числа и добавляем их в вектор
    }

    auto it = V.begin();  // Инициализируем итератор для вектора
    int index = 1;  // Счетчик для определения нечетных номеров

    // Проходим по вектору и удаляем элементы с нечетными индексами
    while (it != V.end()) {  // Пока не достигнут конец вектора
        if (index % 2 != 0) {  // Если индекс нечетный
            it = V.erase(it);  // Удаляем элемент и обновляем итератор
        } else {  // Если индекс четный
            ++it;  // Просто перемещаем итератор вперед
        }
        ++index;  // Увеличиваем индекс
    }

    cout << "Вектор после удаления элементов с нечетными порядковыми номерами: ";  // Подсказка для вывода
    for (const auto& elem : V) {  // Проходим по всем элементам вектора
        cout << elem << " ";  // Выводим каждый элемент
    }
    cout << endl;  // Переход на новую строку
}

// Задание 4
void task4(const string& filename) {
    ifstream infile(filename);  // Открываем файл для чтения
    if (!infile.is_open()) {  // Проверяем, открыт ли файл
        cerr << "Ошибка открытия файла." << endl;  // Сообщаем об ошибке
        return;  // Выходим из функции
    }

    // Считываем целые числа из файла в вектор
    vector<int> numbers((istream_iterator<int>(infile)), istream_iterator<int>());  // Используем итераторы для чтения чисел
    infile.close();  // Закрываем файл после чтения

    // Проверяем, есть ли хотя бы одно число для вывода
    if (numbers.empty()) {  // Если вектор пуст
        cout << "Файл пуст или не содержит чисел." << endl;  // Сообщаем об ошибке
        return;  // Выходим из функции
    }

    // Выводим числа с нечетными порядковыми номерами (то есть с индексами 1, 3, 5 и т.д.)
    cout << "Числа с нечетными порядковыми номерами: ";  // Подсказка для вывода
    for (size_t i = 0; i < numbers.size(); i += 2) {  // Проходим по всем нечетным индексам
        cout << numbers[i] << " ";  // Выводим элемент с нечетным индексом
    }
    cout << endl;  // Переход на новую строку
}

// Задание 5
void task5() {
    int N = inputInteger("Введите количество элементов в векторе: ");  // Вводим количество элементов в векторе
    vector<int> V(N);  // Создаем вектор фиксированной длины
    
    cout << "Введите " << N << " элементов вектора: ";  // Подсказка для ввода элементов вектора
    for (int i = 0; i < N; ++i) {  // Цикл для ввода элементов
        cin >> V[i];  // Вводим элемент
    }

    int K = inputInteger("Введите K (количество элементов для дублирования): ");  // Вводим количество элементов для дублирования
    
    if (K <= 0 || K > V.size()) {  // Проверяем, корректно ли введено значение K
        cout << "Некорректное значение K." << endl;  // Сообщаем об ошибке
        return;  // Выходим из функции
    }

    // Создаем последовательность равную первому K элементам вектора V
    vector<int> sequence(V.begin(), V.begin() + K);  // Копируем первые K элементов в новый вектор
    
    // Вставляем последовательность в конец вектора V
    V.insert(V.end(), sequence.begin(), sequence.end());  // Добавляем скопированные элементы в конец вектора

    cout << "Вектор после дублирования: ";  // Подсказка для вывода обновленного вектора
    for (const auto& elem : V) {  // Проходим по всем элементам вектора
        cout << elem << " ";  // Выводим каждый элемент
    }
    cout << endl;  // Переход на новую строку
}

// Задание 6
void task6() {
    int n, input;  // Переменные для хранения количества элементов и введенных значений
    
    // Список 1
    cout << "Введите количество элементов в первом списке (четное): ";  // Подсказка для ввода количества
    cin >> n;  // Вводим количество элементов
    
    if (n % 2 != 0) {  // Проверяем, является ли количество четным
        cout << "Ошибка: количество элементов должно быть четным." << endl;  // Сообщаем об ошибке
        return;  // Выходим из функции
    }
    
    list<int> L1;  // Создаем первый список
    cout << "Введите " << n << " элементов для первого списка: ";  // Подсказка для ввода
    for (int i = 0; i < n; ++i) {  // Цикл для ввода элементов
        cin >> input;  // Вводим элемент
        L1.push_back(input);  // Добавляем элемент в список
    }
    
    // Дублирование первой половины в обратном порядке с использованием reverse_copy
    auto mid1 = next(L1.begin(), n / 2);  // Нахождение середины списка
    list<int> L1_copy(n / 2);  // Создание временного списка для хранения копии первой половины
    reverse_copy(L1.begin(), mid1, L1_copy.begin());  // Копируем и реверсируем первую половину в L1_copy
    L1.insert(L1.end(), L1_copy.begin(), L1_copy.end());  // Вставляем реверсированную половину в конец первого списка
    
    // Список 2
    cout << "Введите количество элементов во втором списке (четное): ";  // Подсказка для ввода количества второго списка
    cin >> n;  // Вводим количество элементов
    
    if (n % 2 != 0) {  // Проверяем, является ли количество четным
        cout << "Ошибка: количество элементов должно быть четным." << endl;  // Сообщаем об ошибке
        return;  // Выходим из функции
    }
    
    list<int> L2;  // Создаем второй список
    cout << "Введите " << n << " элементов для второго списка: ";  // Подсказка для ввода
    for (int i = 0; i < n; ++i) {  // Цикл для ввода элементов
        cin >> input;  // Вводим элемент
        L2.push_back(input);  // Добавляем элемент в список
    }
    
    // Дублирование первой половины в обратном порядке с использованием insert и обратных итераторов
    auto mid2 = next(L2.begin(), n / 2);  // Нахождение середины второго списка
    L2.insert(L2.end(), make_reverse_iterator(mid2), make_reverse_iterator(L2.begin()));  // Добавляем реверсированную первую половину в конец второго списка
    
    // Вывод списков
    cout << "Первый список после дублирования: ";  // Подсказка для вывода первого списка
    for (const auto& elem : L1) {  // Проходим по всем элементам первого списка
        cout << elem << " ";  // Выводим каждый элемент
    }
    cout << endl;  // Переход на новую строку

    cout << "Второй список после дублирования: ";  // Подсказка для вывода второго списка
    for (const auto& elem : L2) {  // Проходим по всем элементам второго списка
        cout << elem << " ";  // Выводим каждый элемент
    }
    cout << endl;  // Переход на новую строку
}

// Главная функция, точка входа в программу
int main() {
    // Бесконечный цикл, который будет работать, пока пользователь не решит выйти
    while (true) {
        // Запросить у пользователя номер задачи и сохранить его в переменной taskNumber
        int taskNumber = inputInteger("Выберите задачу (1-6) или 0 для выхода: ");

        // Проверка, что номер задачи находится в допустимых пределах от 0 до 6
        if (taskNumber < 0 || taskNumber > 6) {
            // Если выбор неверный, выводим сообщение об ошибке и продолжаем цикл
            cout << "Неверный выбор, пожалуйста, попробуйте снова." << endl;
            continue; // Переходим к следующей итерации цикла
        }

        // В зависимости от значения taskNumber выполняем соответствующую задачу
        switch (taskNumber) {
            case 1: // Если выбрана задача 1
                task1("numbers.txt"); // Выполнить задачу 1 с файлом "numbers.txt"
                break; // Завершить выполнение этого case

            case 2: // Если выбрана задача 2
                task2(); // Выполнить задачу 2
                break; // Завершить выполнение этого case

            case 3: // Если выбрана задача 3
                task3(); // Выполнить задачу 3
                break; // Завершить выполнение этого case

            case 4: // Если выбрана задача 4
                task4("numbers.txt"); // Выполнить задачу 4 с файлом "numbers.txt"
                break; // Завершить выполнение этого case

            case 5: // Если выбрана задача 5
                task5(); // Выполнить задачу 5
                break; // Завершить выполнение этого case

            case 6: // Если выбрана задача 6
                task6(); // Выполнить задачу 6
                break; // Завершить выполнение этого case

            case 0: // Если пользователь выбрал 0 для выхода из программы
                cout << "Выход из программы." << endl; // Вывести сообщение об выходе
                return 0; // Завершить программу, возвращая 0 (успешное завершение)
        }
    }
}
 
